{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Abel/Documents/Code/Undergraduate%20Final%20Project/reroute/src/app/live/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { GoogleMap, LoadScript, Marker } from '@react-google-maps/api';\r\n\r\ninterface Vehicle {\r\n  id: string;\r\n  route_id: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  bearing: number;\r\n  speed: number;\r\n  timestamp: string;\r\n}\r\n\r\ninterface VehicleData {\r\n  vehicles: Vehicle[];\r\n  isMockData?: boolean;\r\n}\r\n\r\nconst LiveTrackingPage = () => {\r\n  const [vehicleData, setVehicleData] = useState<VehicleData | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [errorDetails, setErrorDetails] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isMockData, setIsMockData] = useState(false);\r\n\r\n  const mapContainerStyle = {\r\n    width: '100%',\r\n    height: '600px'\r\n  };\r\n\r\n  const center = {\r\n    lat: 33.878840,\r\n    lng: -117.884973\r\n  };\r\n\r\n  const fetchVehicleData = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      setErrorDetails(null);\r\n      \r\n      const response = await fetch('/api/live');\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Failed to fetch vehicle data');\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      // Check if this is mock data\r\n      if (data.vehicles && data.vehicles.length > 0 && \r\n          data.vehicles[0].id === \"1234\" && \r\n          data.vehicles[0].route_id === \"123\") {\r\n        setIsMockData(true);\r\n      } else {\r\n        setIsMockData(false);\r\n      }\r\n      \r\n      setVehicleData(data);\r\n    } catch (err) {\r\n      console.error('Error fetching vehicle data:', err);\r\n      setError(err instanceof Error ? err.message : 'An unknown error occurred');\r\n      \r\n      // Try to extract more detailed error information\r\n      if (err instanceof Error && err.message.includes('Failed to fetch')) {\r\n        try {\r\n          const errorResponse = await fetch('/api/live');\r\n          const errorData = await errorResponse.json();\r\n          if (errorData.details) {\r\n            setErrorDetails(errorData.details);\r\n          }\r\n        } catch (e) {\r\n          console.error('Error fetching error details:', e);\r\n        }\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchVehicleData();\r\n    \r\n    // Set up polling every 30 seconds\r\n    const intervalId = setInterval(fetchVehicleData, 30000);\r\n    \r\n    return () => clearInterval(intervalId);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"container mx-auto p-4\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Live Bus Tracking</h1>\r\n      \r\n      {isMockData && (\r\n        <div className=\"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4\">\r\n          <p className=\"font-bold\">Using Mock Data</p>\r\n          <p>The live tracking feature is currently using mock data because the required Python dependencies are not installed. This is for demonstration purposes only.</p>\r\n        </div>\r\n      )}\r\n      \r\n      {error && (\r\n        <div className=\"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4\">\r\n          <p className=\"font-bold\">Error</p>\r\n          <p>{error}</p>\r\n          \r\n          {errorDetails && (\r\n            <div className=\"mt-2\">\r\n              <button \r\n                className=\"text-red-700 underline\"\r\n                onClick={() => setErrorDetails(errorDetails ? null : 'expanded')}\r\n              >\r\n                {errorDetails === 'expanded' ? 'Hide Details' : 'Show Details'}\r\n              </button>\r\n              \r\n              {errorDetails === 'expanded' && (\r\n                <pre className=\"mt-2 p-2 bg-red-50 rounded text-sm overflow-auto max-h-40\">\r\n                  {errorDetails}\r\n                </pre>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      \r\n      {isLoading && !vehicleData && (\r\n        <div className=\"flex justify-center items-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n        </div>\r\n      )}\r\n      \r\n      {vehicleData && (\r\n        <div>\r\n          <LoadScript googleMapsApiKey={process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY || ''}>\r\n            <GoogleMap\r\n              mapContainerStyle={mapContainerStyle}\r\n              center={center}\r\n              zoom={13}\r\n            >\r\n              {vehicleData.vehicles.map((vehicle) => (\r\n                <Marker\r\n                  key={vehicle.id}\r\n                  position={{ lat: vehicle.latitude, lng: vehicle.longitude }}\r\n                  icon={{\r\n                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,\r\n                    scale: 5,\r\n                    rotation: vehicle.bearing,\r\n                    fillColor: '#4285F4',\r\n                    fillOpacity: 1,\r\n                    strokeWeight: 1,\r\n                    strokeColor: '#FFFFFF',\r\n                  }}\r\n                  title={`Route ${vehicle.route_id} - Speed: ${vehicle.speed} mph`}\r\n                />\r\n              ))}\r\n            </GoogleMap>\r\n          </LoadScript>\r\n          \r\n          <div className=\"mt-4\">\r\n            <h2 className=\"text-xl font-semibold mb-2\">Active Vehicles</h2>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full bg-white border border-gray-300\">\r\n                <thead>\r\n                  <tr className=\"bg-gray-100\">\r\n                    <th className=\"py-2 px-4 border-b\">Vehicle ID</th>\r\n                    <th className=\"py-2 px-4 border-b\">Route</th>\r\n                    <th className=\"py-2 px-4 border-b\">Speed</th>\r\n                    <th className=\"py-2 px-4 border-b\">Last Updated</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {vehicleData.vehicles.map((vehicle) => (\r\n                    <tr key={vehicle.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"py-2 px-4 border-b\">{vehicle.id}</td>\r\n                      <td className=\"py-2 px-4 border-b\">Route {vehicle.route_id}</td>\r\n                      <td className=\"py-2 px-4 border-b\">{vehicle.speed} mph</td>\r\n                      <td className=\"py-2 px-4 border-b\">\r\n                        {new Date(vehicle.timestamp).toLocaleTimeString()}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LiveTrackingPage;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 372, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}